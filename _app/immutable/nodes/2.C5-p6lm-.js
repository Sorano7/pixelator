import{f as ke,a as we}from"../chunks/BdeG7VYi.js";import{o as xe}from"../chunks/Fu1uMN08.js";import{A as T,g as $,u as fe,B as ye,h as q,c as R,C as Re,D as Ce,x as ve,E as t,F as f,G as Le,H as n,I as k,J as w,K as i}from"../chunks/DQy6PPDi.js";import{d as Ue}from"../chunks/DmqYL6Co.js";import{r as S}from"../chunks/BD88GfID.js";import{b as ze}from"../chunks/3dS4EG-o.js";function de(e,o,d=o){var u=new WeakSet;T(e,"input",async c=>{var l=c?e.defaultValue:e.value;if(l=Q(e)?F(l):l,d(l),R!==null&&u.add(R),await ye(),l!==(l=o())){var p=e.selectionStart,h=e.selectionEnd,b=e.value.length;if(e.value=l??"",h!==null){var g=e.value.length;p===h&&h===b&&g>b?(e.selectionStart=g,e.selectionEnd=g):(e.selectionStart=p,e.selectionEnd=Math.min(h,g))}}}),(q&&e.defaultValue!==e.value||fe(o)==null&&e.value)&&(d(Q(e)?F(e.value):e.value),R!==null&&u.add(R)),$(()=>{var c=o();if(e===document.activeElement){var l=Re??R;if(u.has(l))return}Q(e)&&c===F(e.value)||e.type==="date"&&!c&&!e.value||c!==e.value&&(e.value=c??"")})}function ue(e,o,d=o){T(e,"change",u=>{var c=u?e.defaultChecked:e.checked;d(c)}),(q&&e.defaultChecked!==e.checked||fe(o)==null)&&d(e.checked),$(()=>{var u=o();e.checked=!!u})}function Q(e){var o=e.type;return o==="number"||o==="range"}function F(e){return e===""?null:+e}function Se(e,o,d=o){T(e,"change",()=>{d(e.files)}),q&&e.files&&d(e.files),$(()=>{e.files=o()})}var Me=ke('<div class="app svelte-1uha8ag"><div class="canvas-shell svelte-1uha8ag"><div class="canvas-inner svelte-1uha8ag"><canvas class="svelte-1uha8ag"></canvas></div></div> <aside class="panel svelte-1uha8ag"><header class="panel-header svelte-1uha8ag"><h1 class="svelte-1uha8ag">Pixelator + Quantizer</h1> <p class="svelte-1uha8ag">Upload an image and tweak the effect.</p></header> <div class="panel-body svelte-1uha8ag"><div class="control-group svelte-1uha8ag"><label for="file" class="svelte-1uha8ag">Image</label> <div class="file-input svelte-1uha8ag"><input id="file" type="file" accept="image/*" class="svelte-1uha8ag"/></div></div> <div class="control-row svelte-1uha8ag"><div class="control-toggle svelte-1uha8ag"><label for="pixelate" class="svelte-1uha8ag"><span class="svelte-1uha8ag">Pixelate</span> <input id="pixelate" type="checkbox" class="svelte-1uha8ag"/></label></div> <div class="control-slider svelte-1uha8ag"><label for="block" class="svelte-1uha8ag"><span>Block size</span> <input id="block" type="range" min="2" max="64" step="1" class="svelte-1uha8ag"/></label></div></div> <div class="control-row svelte-1uha8ag"><div class="control-toggle svelte-1uha8ag"><label for="quantize" class="svelte-1uha8ag"><span class="svelte-1uha8ag">Quantize</span> <input id="quantize" type="checkbox" class="svelte-1uha8ag"/></label></div> <div class="control-slider svelte-1uha8ag"><label for="palette" class="svelte-1uha8ag"><span>Palette size</span> <input id="palette" type="range" min="2" max="64" step="1" class="svelte-1uha8ag"/></label></div> <button class="download-button svelte-1uha8ag">Download</button></div></div></aside></div>');function We(e,o){Ce(o,!0);const d=4e3;let u=k(null),c=null,l=k(null),p=k(!0),h=k(16),b=k(!0),g=k(16),x,M=null,I=!1,O=!1,C=null,y;xe(()=>{typeof OffscreenCanvas<"u"&&(c=new OffscreenCanvas(d,d)),typeof Worker<"u"&&(C=new Worker(new URL(""+new URL("../workers/image-worker-CZF0tC3t.js",import.meta.url).href,import.meta.url),{type:"module"}),C.onmessage=a=>{const{width:s,height:r,buffer:v}=a.data,L=t(l)?.getContext("2d");if(!L||!t(l))return;const U=new Uint8ClampedArray(v),m=new ImageData(U,s,r);L.putImageData(m,0,0)})}),ve(()=>{if(!t(u))return;const a=t(u)[0];if(!a)return;console.log(`Loaded file: ${a.name}`),y=a.name;const s=URL.createObjectURL(a),r=new Image;r.src=s,r.onload=()=>{console.log(`Loaded image size: ${r.width} x ${r.height}`);try{he(r),E()}catch(v){console.error(v)}finally{URL.revokeObjectURL(s)}},r.onerror=()=>{console.error("Could not load image file."),URL.revokeObjectURL(s)}}),ve(()=>{t(p),t(h),t(b),t(g),x&&(M!==null&&clearTimeout(M),M=window.setTimeout(()=>{E()},150))});function he(a){if(!c||!t(l))return;const s=a.naturalWidth||a.width,r=a.naturalHeight||a.height;let v=1;const L=d/Math.max(s,r);v=Math.min(v,L,1);const U=t(l).parentElement;if(U){const ie=U.getBoundingClientRect(),oe=ie.width,ce=ie.height;if(oe>0&&ce>0){const _e=Math.min(oe/s,ce/r);v=Math.min(v,_e,1)}}const m=Math.round(s*v),_=Math.round(r*v),z=c.getContext("2d");if(!z)return;c.width=m,c.height=_,z.clearRect(0,0,m,_),z.drawImage(a,0,0,m,_),x=z.getImageData(0,0,m,_);const ne=t(l).getContext("2d");ne&&(t(l).width=m,t(l).height=_,ne.clearRect(0,0,m,_))}function E(){if(!(!C||!x)){if(I){O=!0;return}I=!0;try{const{width:a,height:s,data:r}=x;C.postMessage({width:a,height:s,data:r,doPixelate:t(p),blockSize:t(h),doQuantize:t(b),paletteSize:t(g)})}catch(a){console.error(a)}finally{I=!1,O&&(O=!1,E())}}}function ge(){if(!x)return;let a="output.png";if(y){const s=y.lastIndexOf(".");a=y.slice(0,s)+"_output"+y.slice(s)}t(l)?.toBlob(s=>{if(!s)return;const r=URL.createObjectURL(s),v=document.createElement("a");v.href=r,v.download=a,v.click(),URL.revokeObjectURL(r)},"image/png")}var D=Me(),P=n(D),V=n(P),me=n(V);ze(me,a=>w(l,a),()=>t(l)),i(V),i(P);var Z=f(P,2),G=f(n(Z),2),j=n(G),J=f(n(j),2),pe=n(J);i(J),i(j);var W=f(j,2),B=n(W),K=n(B),X=f(n(K),2);S(X),i(K),i(B);var N=f(B,2),Y=n(N),ee=f(n(Y),2);S(ee),i(Y),i(N),i(W);var ae=f(W,2),A=n(ae),te=n(A),le=f(n(te),2);S(le),i(te),i(A);var H=f(A,2),se=n(H),re=f(n(se),2);S(re),i(se),i(H);var be=f(H,2);be.__click=ge,i(ae),i(G),i(Z),i(D),Se(pe,()=>t(u),a=>w(u,a)),ue(X,()=>t(p),a=>w(p,a)),de(ee,()=>t(h),a=>w(h,a)),ue(le,()=>t(b),a=>w(b,a)),de(re,()=>t(g),a=>w(g,a)),we(e,D),Le()}Ue(["click"]);export{We as component};
